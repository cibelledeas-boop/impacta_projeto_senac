<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IMPACTA</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/img_feed/simbolo-logo1.png') }}" sizes="192x192" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/feed.css') }}" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>

<body>
  <aside class="menu-lateral-esquerdo instagram-style">
    <nav class="menu-list">
            <a href="{{ url_for('feed') }}" class="menu-item active"><i class="fa-solid fa-globe"></i> <span>Feed</span></a>
            <a href="{{ url_for('perfil') }}" class="menu-item"><i class="fa-solid fa-user"></i> <span>Perfil</span></a>
            <a href="{{ url_for('direct') }}" class="menu-item"><i class="fa-solid fa-paper-plane"></i> <span>Direct</span></a>
            <a href="{{ url_for('landing') }}" class="menu-item"><i class="fa-solid fa-bullhorn"></i> <span>Landing</span></a>
            <a href="{{ url_for('notificacoes') }}" class="menu-item"><i class="fa-solid fa-bell"></i> <span>Notifica√ß√µes</span></a>
    </nav>
  </aside>

  <!--Topo -->
  <header class="topbar">
    <div class="logo-area">
      <img src="{{ url_for('static', filename='img/img_feed/impactaimg.jpg') }}" alt="Logo Impacta" class="logo" />
    </div>

    <div class="search" role="search">
      <div class="search-input-wrapper">
        <input id="searchInput" placeholder="Pesquise perfis, campanhas ou itens" aria-label="Buscar" />
        <i data-lucide="search" class="search-icon"></i>
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" id="abrirInfo">
        <i id="icon-plus" data-lucide="plus"></i>Criar Post
      </button>
     
      <div id="notificacoes-box" class="notificacoes-box">
        <div class="notificacoes-header">
          <span>Notifica√ß√µes</span>
          <button id="close-notificacoes" class="close-notificacoes" aria-label="Fechar notifica√ß√µes">√ó</button>
        </div>
        <div class="notificacoes-list">
          <div class="notificacao-item">
            <span>Voc√™ recebeu uma nova mensagem!</span>
          </div>
          <div class="notificacao-item">
            <span>Sua campanha foi aprovada.</span>
          </div>
          <div class="notificacao-item">
            <span>Algu√©m seguiu seu perfil.</span>
          </div>
        </div>
      </div>
    </div>

  </header>

  <div class="main-content-wrapper">
    <div id="infoOverlay" class="info-overlay">
      <div class="info-box">
        <h2>Criar Post</h2>
         <section class="interaction">
        <div class="button-group">
          <label><input type="radio" name="categoria" value="historia"> Hist√≥ria</label>
          <label><input type="radio" name="categoria" value="campanha"> Campanha</label>
          <label><input type="radio" name="categoria" value="item"> Item</label>
        </div>
      </section>
      <h4>Compartilhe sua hist√≥ria</h4>

      <form class="post-form" id="postForm" method="POST" action="/publicar" enctype="multipart/form-data">
        <textarea id="textoPost" name="texto" placeholder="Qual foi sua boa a√ß√£o de hoje?" required></textarea>
           <div class="upload-container">
        <label for="foto" class="botao-foto">Adicionar foto(s)</label>
        <input type="file" id="foto" name="foto" accept="image/*" multiple max="4">
      </div>
        <input type="hidden" name="categoria" id="categoriaInput" value="historia">
        <button type="submit" class="btn primary enviar-btn">
          Publicar
        </button>
      </form>

      <button id="fecharInfo" class="fechar">Fechar</button>
    </div>
    </div>


    <main class="container main-with-suggestions">
      {% for post in publicacoes %}
      <article class="card" data-post-id="{{ post.id }}">
        <div class="header">
          <img src="{{ url_for('static', filename='img/img_feed/user_ex_feminino.jpg') }}" alt="Autor" class="avatar" />
          <div class="author-info">
            <div class="author-name">
              <span>{{ post.autor }}</span>
              <span class="badge">{{ post.categoria }}</span>
            </div>
            <p class="timestamp">{{ post.timestamp }}</p>
            <span class="post-id">ID: {{ post.id }}</span>
          </div>
          <button class="action-btn delete-post-btn" data-post-id="{{ post.id }}" title="Excluir post" style="margin-left:auto;">
            <i data-lucide="trash-2"></i>
          </button>
        </div>
        <div class="content">
          <p>{{ post.texto }}</p>
          {% if post.fotos_urls and post.fotos_urls|length > 0 %}
          <div class="image-grid image-grid-{{ post.fotos_urls|length }}">
            {% for url in post.fotos_urls %}
            <img src="{{ url_for('static', filename=url) }}" alt="Imagem do post" class="post-image" />
            {% endfor %}
          </div>
          {% endif %}
        </div>
        <div class="actions">
          <button class="action-btn like-btn" data-post-id="{{ post.id }}">
            <i data-lucide="heart"></i>
            <span class="count">{{ post.curtidas }}</span>
          </button>
          <button class="action-btn toggle-comments-btn" data-post-id="{{ post.id }}">
            <i data-lucide="message-circle"></i>
            <span>Ver coment√°rios ({{ post.comentarios|length }})</span>
          </button>
        </div>
        <div class="comments comments-accordion" id="comments-{{ post.id }}" style="display:none;">
          <h5>Coment√°rios ({{ post.comentarios|length }})</h5>
          <ul>
            {% for comentario in post.comentarios %}
            <li>
              <b>{{ comentario.autor }}:</b> {{ comentario.texto }}
              <form class="delete-comment-form" data-post-id="{{ post.id }}" data-comment-idx="{{ loop.index0 }}" method="POST" action="/excluir_comentario/{{ post.id }}/{{ loop.index0 }}" style="display:inline;">
                <button type="submit" class="delete-comment-btn" title="Excluir coment√°rio" style="color:#e74c3c;background:none;border:none;cursor:pointer;font-size:1em;">üóëÔ∏è</button>
              </form>
            </li>
            {% endfor %}
          </ul>
          <form class="comment-form" data-post-id="{{ post.id }}" method="POST" action="/comentar/{{ post.id }}">
            <input type="text" name="comentario" placeholder="Adicionar coment√°rio..." required />
            <button type="submit">Comentar</button>
          </form>
        </div>
      </article>
      {% endfor %}
    </main>
    <aside class="suggestions-box right-sidebar">
      <h3>Sugest√µes para voc√™</h3>
      <ul class="suggestions-list">
        <li class="suggestion-item">
          <img src="{{ url_for('static', filename='img/img_feed/user_ex_feminino.jpg') }}" alt="Ana Lima" class="suggestion-avatar" />
          <div class="suggestion-info">
            <span class="suggestion-name">Ana Lima</span>
            <span class="suggestion-desc">Volunt√°ria</span>
          </div>
          <button class="btn btn-follow">Seguir</button>
        </li>
        <li class="suggestion-item">
          <img src="{{ url_for('static', filename='img/img_feed/gerando-falcoes.avif') }}" alt="gerando-falcoes" class="suggestion-avatar" />
          <div class="suggestion-info">
            <span class="suggestion-name">Gerando Falc√µes</span>
            <span class="suggestion-desc">ONG</span>
          </div>
          <button class="btn btn-follow">Seguir</button>
        </li>
        <li class="suggestion-item">
          <img src="{{ url_for('static', filename='img/img_feed/homem-retrato-rindo.jpg') }}" alt="Lucas Lima" class="suggestion-avatar" />
          <div class="suggestion-info">
            <span class="suggestion-name">Lucas Lima</span>
            <span class="suggestion-desc">Doador</span>
          </div>
          <button class="btn btn-follow">Seguir</button>
        </li>
      </ul>
      <!-- Sess√£o Pontos de Coleta -->
      <section class="coleta-box">
        <h3>Pontos de Coleta Parceiros</h3>
        <div id="mapa-coleta"></div>
      </section>
    </aside>
  </div>

  <footer>
    <p>Impacta ‚Äî Todos os direitos reservados aos autores.</p>
  </footer>

 
  <button id="chatbot-float-btn" class="chatbot-float-btn" aria-label="Abrir chat" title="Abrir Chatbot Impacta">
    <img src="{{ url_for('static', filename='img/img_feed/simbolo-logo1.png') }}" alt="Chatbot Impacta" />
    <span class="chatbot-tooltip">Assistente Nati</span>
  </button>

  
  <div id="chatbot-box" class="chatbot-box">
    <div class="chatbot-header">
      <span>Assistente Impacta</span>
      <button id="close-chatbot" class="close-chatbot" aria-label="Fechar chat">√ó</button>
    </div>
    <div class="chatbot-messages">
      <div class="chatbot-message chatbot-message-bot">
        <img src="{{ url_for('static', filename='img/img_feed/avatar_nati.png') }}" alt="Bot" class="chatbot-icon">
        <span>Ol√°! Eu sou a Nati! Como posso ajudar voc√™ hoje?</span>
      </div>
    </div>
    <form class="chatbot-input-area">
      <input type="text" placeholder="Digite sua mensagem..." autocomplete="off" />
      <button type="submit">Enviar</button>
    </form>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    lucide.createIcons();
  </script>
</body>
</html>
