<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Perfil | Impacta Social</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

    <header class="sidebar sidebar-minimal">
        <div class="logo-area">
            <img src="{{ url_for('static', filename='img/img_feed/impactaimg.jpg') }}" class="logo-min"> 
        </div>

        <nav class="menu">
            <a href="{{ url_for('feed') }}" class="menu-item "><i class="fa-solid fa-globe"></i> <span>Feed</span></a>
            <a href="{{ url_for('perfil') }}" class="menu-item active"><i class="fa-solid fa-user"></i> <span>Perfil</span></a>
            <a href="{{ url_for('direct') }}" class="menu-item"><i class="fa-solid fa-paper-plane"></i> <span>Direct</span></a>
            <a href="{{ url_for('landing') }}" class="menu-item"><i class="fa-solid fa-bullhorn"></i> <span>Landing</span></a>
            <a href="{{ url_for('notificacoes') }}" class="menu-item"><i class="fa-solid fa-bell"></i> <span>Notifica√ß√µes</span></a>
        </nav>
    </header>


    <main class="perfil-container">

        <section class="perfil-info">
            <img src="{{ url_for('static', filename=usuario_foto_perfil if usuario_foto_perfil else 'img/img_feed/user_ex_feminino.jpg') }}"
                class="perfil-avatar"> 

            <div class="infos">
                <h2 id="nome-perfil">@{{ usuario_nome }}</h2> <ul class="stats">
                    <li><strong>12</strong> publica√ß√µes</li>
                    <li><strong>340</strong> seguidores</li>
                    <li><strong>280</strong> seguindo</li>
                </ul>

                <p id="bio-perfil">
                    Impacto social ‚Ä¢ Educa√ß√£o ‚Ä¢ Comunidade <br>
                    ‚ÄúServir √© a forma mais verdadeira de liderar.‚Äù
                </p> <button class="edit-btn" id="open-edit">Editar Perfil</button>
            </div>
        </section>

        <section class="perfil-posts">
            <div class="posts-header">
                <i class="fa-solid fa-border-all"></i>
                <h3><strong>Publica√ß√µes</strong></h3>
            </div>

                        <div class="posts-grid">
                                {% if publicacoes %}
                                    {% for post in publicacoes %}
                                                                                {% if post.fotos_urls and post.fotos_urls|length > 0 %}
                                                                                        {% for url in post.fotos_urls %}
                                                                                                <div class="post-item">
                                                                                                        <img src="{{ url_for('static', filename=url) }}" alt="Imagem da publica√ß√£o">
                                                                                                        {% if post.comentarios and post.comentarios|length > 0 %}
                                                                                                        <ul class="perfil-comments">
                                                                                                                {% for comentario in post.comentarios %}
                                                                                                                <li>
                                                                                                                    <b>{{ comentario.autor }}:</b> {{ comentario.texto }}
                                                                                                                    {% set interesse = false %}
                                                                                                                    {% for palavra in ['quero', 'interesse', 'posso buscar', 'tenho interesse', 'me interesso', 'aceito', 'gostaria'] %}
                                                                                                                        {% if palavra in comentario.texto|lower %}
                                                                                                                            {% set interesse = true %}
                                                                                                                        {% endif %}
                                                                                                                    {% endfor %}
                                                                                                                    {% if usuario_id == post.autor_id and comentario.autor_id != usuario_id and interesse %}
                                                                                                                        <form method="GET" action="{{ url_for('direct_novo', user_id=comentario.autor_id) }}" style="display:inline;">
                                                                                                                            <button type="submit" class="btn btn-primary" style="margin-left:8px; font-size:0.9em; padding:2px 10px;">Conversar</button>
                                                                                                                        </form>
                                                                                                                    {% endif %}
                                                                                                                </li>
                                                                                                                {% endfor %}
                                                                                                        </ul>
                                                                                                        {% endif %}
                                                                                                </div>
                                                                                        {% endfor %}
                                                                                {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <p class="sem-publicacoes">Nenhuma publica√ß√£o com imagem encontrada.</p>
                                {% endif %}
                        </div>
        </section>

    </main>

    <div id="edit-modal" class="popup-ig">
        <div class="popup-card">
            <h3 class="titulo-ig">Editar Perfil</h3>
            <span class="close-ig" id="close-edit">&times;</span> <div class="edit-header">
                <img src="{{ url_for('static', filename=usuario_foto_perfil if usuario_foto_perfil else 'img/img_feed/user_ex_feminino.jpg') }}" class="edit-avatar"> 
                <div>
                     <span class="change-photo" onclick="document.getElementById('edit-file').click()">Mudar Foto do Perfil</span>
                     <input type="file" id="edit-file" style="display: none;" accept="image/*"> 
                </div>
            </div>

            <form id="edit-form" class="edit-form">
                <div class="form-row">
                    <label for="edit-nome">Nome de Usu√°rio (@)</label>
                    <input type="text" id="edit-nome" required> </div>

                <div class="form-row">
                    <label for="edit-bio">Biografia</label>
                    <textarea id="edit-bio"></textarea> </div>

                <button type="submit" class="btn-salvar">Salvar</button>
            </form>
        </div>
    </div>
    <div id="view-post-modal" class="popup-ig post-viewer">
        <div class="popup-card post-card-viewer">
            <span class="close-ig" id="close-view-post">&times;</span>
            <div class="viewer-content">
                
                <div class="viewer-media">
                    <img id="viewer-img" src="" alt="Post">
                </div>
                
                <div class="viewer-details">
                    <div class="viewer-header">
                        <img class="viewer-avatar" src="{{ url_for('static', filename=usuario_foto_perfil if usuario_foto_perfil else 'img/img_feed/user_ex_feminino.jpg') }}">
                        <strong>@{{ usuario_nome }}</strong>
                    </div>
                    
                    <div class="viewer-comments">
                        <p class="post-caption">Impacto social: a verdadeira mudan√ßa come√ßa na educa√ß√£o. üìö</p>
                        <div class="comment-item">
                            <small><strong>@user1:</strong> Incr√≠vel iniciativa!</small>
                        </div>
                        <div class="comment-item">
                            <small><strong>@ong_ajuda:</strong> Parab√©ns pelo trabalho!</small>
                        </div>
                    </div>
                    
                    <div class="viewer-actions">
                        <i class="fa-solid fa-heart"></i>
                        <i class="fa-solid fa-comment"></i>
                        <i class="fa-solid fa-paper-plane"></i>
                    </div>
                    
                    <div class="viewer-input">
                        <input type="text" placeholder="Adicione um coment√°rio...">
                        <button>Postar</button>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/perfil.js') }}"></script>
</body>
</html>