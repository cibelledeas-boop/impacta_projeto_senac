"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c9422536-34e5-5d8e-abcc-7c3261c728e9")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([["9679"],{723819:function(e,t,r){r.d(t,{Ll:()=>l,Nt:()=>o,Qy:()=>n,xF:()=>d});var s=r(551916),a=r(45190),i=r(10553);function n(e){let t=(0,a.DG)(i.O3Q,{fileKey:e},{enabled:!!e});if(null!==t.data&&!t.data?.file?.plan){let t={code:"nonNullableResult",path:[],retriable:!1,error:Error("No Plan found for file, key: "+e)};return s.IE.error([t])}return t.transform(e=>e.file?.plan)}function l(e){let t=(0,a.DG)(i.U_b,{fileKey:e},{enabled:!!e});if(null!==t.data&&!t.data?.file?.currentPlanUser){let t={code:"nonNullableResult",path:[],retriable:!1,error:Error("No PlanUser found for file, key: "+e)};return s.IE.error([t])}return t.transform(e=>e.file?.currentPlanUser)}function o(e){let t=(0,a.DG)(i.eA4,{teamId:e},{enabled:!!e});if(null!==t.data&&!t.data?.team?.plan){let t={code:"nonNullableResult",path:[],retriable:!1,error:Error("No Plan found for team, id: "+e)};return s.IE.error([t])}return t.transform(e=>e.team?.plan)}function d(e){let t=(0,a.DG)(i.q8_,{orgId:e},{enabled:!!e});if(null!==t.data&&!t.data?.org?.plan){let t={code:"nonNullableResult",path:[],retriable:!1,error:Error("No Plan found for org, id: "+e)};return s.IE.error([t])}return t.transform(e=>e.org?.plan)}},489617:function(e,t,r){r.d(t,{O:()=>l});var s=r(723014),a=r(377064),i=r(667438);let n=s.z.object({js_url:s.z.string(),css_url:s.z.string()}),l=new class{constructor(){this.GetCachedPreviewUrlsValidator=(0,a._p)("GetCachedPreviewUrlsValidator",(0,i.u)(n),null)}getCachedPreviewUrls(e){return this.GetCachedPreviewUrlsValidator.validate(async({xr:t})=>await t.get(`/api/make/${e.fileKey}/cached_preview_urls`,{source_code_hash:e.sourceCodeHash}))}}},370452:function(e,t,r){r.d(t,{T:()=>s});let s="https://go/figmascope-docs"},92472:function(e,t,r){r.d(t,{$Q:()=>l,kI:()=>n,x:()=>i});var s=r(750357),a=r(491420);function i(){return(0,s.jsx)(l,{children:(0,s.jsx)("p",{children:"Reading file..."})})}function n({error:e}){let t="Oops! Something went wrong";return"string"==typeof e?t=e:e instanceof Error&&(t=e.message,console.error(e)),(0,s.jsx)(l,{children:(0,s.jsx)("p",{style:a.sx.colorTextOndanger.colorBgDanger.p16.font20.maxW400.$,children:t})})}function l({children:e}){return(0,s.jsx)("div",{style:a.sx.fillPositionedContainer.flex.itemsCenter.justifyCenter.flexColumn.lh1_5Lines.font16.$,children:e})}},407690:function(e,t,r){r.d(t,{A:()=>tm});var s=r(750357),a=r(853505),i=r(778464),n=r(363240),l=r(444947),o=r(962626),d=r(424969),c=r(203570),u=r(491420),h=r(899140),f=r(72615),p=r(40540),m=r(681768),_=r(845277),g=r(272380),b=r(106502);let x=(0,n.cn)(e=>{let t=e(_.E8);return"fullscreen"===t.view?`/api/file/scenegraph_validations/${t.fileKey}`:(0,g.i)(t)&&t.urlParams?.type==="server_file"?`/api/admin/scenegraph_validations/${t.urlParams.key}`:null}),y=(0,n.cn)(e=>null!=e(x)),v=(()=>{let e=(0,n.cn)((0,p.AW)());return(0,n.cn)(t=>t(e),async(t,r)=>{let s;if(t(e).status===c.Q.LOADING)return;let a=t(x);if(a){r(e,(0,p.RN)());try{s=await j(a)}catch(t){r(e,(0,p.SA)(t));return}r(e,(0,p.r7)(s))}})})();async function j(e){let t=await (0,m._e)(e),r=new b.k;for(let e of t.data.meta.data.results.violations)if("always-fail-for-testing"!==e.name)for(let t of e.instances)r.add(t.guid,t.message);return r}var k=r(697466),I=r(872965),C=r(92472),w=r(983051),S=r(519226),E=r(527986),D=r(641857),N=r(685059),F=r(910203),T=r.n(F),P=r(661193),O=r(864197),M=r(705783);let R=(0,I.D2)("bookmarkSettings",{bookmarks:{}}),A=(0,n.cn)(e=>{let t=e(R),r=e(f.Pm).id;return new Set((t.bookmarks[r]??[]).map(e=>e.id))});function B(){let[e,t]=(0,n.KO)(R),r=(0,n.Dv)(f.Pm).id,s=a.useCallback(s=>{t({...e,bookmarks:{...e.bookmarks,[r]:s(e.bookmarks[r]||[])}})},[e,r,t]),i=a.useCallback((e,t)=>{s(r=>[...r,{id:e,name:t}])},[s]),l=a.useCallback(e=>{s(t=>t.filter((t,r)=>r!==e))},[s]),o=a.useCallback((e,t)=>{s(r=>r.map((r,s)=>s===e?{...r,name:t}:r))},[s]),d=a.useCallback((e,t)=>{s(r=>r.map((r,s)=>s===e?{...r,id:M.ue.fromString(t)}:r))},[s]),c=a.useCallback(e=>{s(t=>{if(e>=t.length-1)return t;let r=t.slice(),[s]=r.splice(e,1);return r.splice(e+1,0,s),r})},[s]);return{addBookmark:i,deleteBookmark:l,moveBookmarkDown:c,moveBookmarkUp:a.useCallback(e=>{s(t=>{if(e<=0)return t;let r=t.slice(),[s]=r.splice(e,1);return r.splice(e-1,0,s),r})},[s]),renameBookmark:o,updateBookmarkId:d,bookmarks:a.useMemo(()=>e.bookmarks[r]||[],[e,r])}}var L=r(723796);function V(e,t,r){return[...e.getObject(r)?.mapDescendants(e=>e.id)??[],...t?.getObject(r)?.mapDescendants(e=>e.id)??[]]}let $=(0,n.oH)((0,n.cn)({}),(e,t,r)=>{let s=r(f.Pm),a=r(f.p2);switch(t.type){case"toggleExpanded":return(0,L.Kt)(e,t.objectId,t.toggleSubtree?V(s,a,t.objectId):[]);case"expandAncestors":var i;return(0,L.wo)(e,(i=t.objectId,[...s.getObject(i)?.mapAncestors(e=>e.id)??[],...a?.getObject(i)?.mapAncestors(e=>e.id)??[]]),!0);case"expandDescendants":return(0,L.wo)(e,[t.objectId,...V(s,a,t.objectId)],!0);case"collapseDescendants":return(0,L.v)(e,[t.objectId,...V(s,a,t.objectId)])}});var z=r(870102),U=r(612661),G=r(574090);let H=(0,n.cn)({status:"initial"}),K=(0,n.cn)(0),Q=(0,n.cn)(!1),W=(0,n.cn)(e=>{if(e(Q)){let t=e(K);return`Indexing search results (this may take a moment)... [${t}/???]`}return null}),Z=(0,I.D2)("searchMode",I.d5.Search),Y=(0,n.cn)(e=>{let t=e(H),r=e(f.Pm),s=e(k.gJ);return"initial"===t.status?s.map(e=>r.getObject(e)).filter(U.lm).map(e=>({object:e,matches:[]})).reverse():"results"in t&&t.results.length>0?t.results:null}),J=(0,n.cn)(e=>{let t=e(H);if("searching"===t.status&&0===t.results.length){let t=["Searching..."],r=e(W);return r&&t.push(r),t}if("success"===t.status&&0===t.results.length){let t=["No results found."],r=e(f.Pm);return r instanceof G.Fu&&t.push("Some content may be unavailable because of incremental loading"),"hide"===r.sensitiveTextPolicy&&t.push("Searching text fields is limited beacuse text redaction has been applied."),t}return"error"===t.status?["Error searching:",String(t.error)]:null}),q=(0,n.cn)(e=>{if(e(Z)!==I.d5.Filter)return null;let t=e(H);return"results"in t?t.results.map(e=>e.object):null}),X=(0,n.cn)(e=>{if(e(Z)!==I.d5.Filter)return null;let t=e(J);return t?t.join(" "):null}),ee=(0,I.D2)("sortOrder",I.Mf.Position),et=(0,n.cn)(e=>{let t=[I.Mf.Position,I.Mf.Name,I.Mf.NodeId];return e(f.Pm).rootObjects[0]?.displayProperties.memoryFraction!=null&&t.push(I.Mf.Memory),t.sort(),t}),er=(0,n.cn)(e=>{switch(e(ee)){case I.Mf.Position:return ea;case I.Mf.Name:return es;case I.Mf.Memory:return en;case I.Mf.NodeId:return ei}});function es(e,t){return e.displayProperties.name.localeCompare(t.displayProperties.name)}function ea(e,t){let[r,s]=el(e,t);if(r&&s){let e=r.parentIndex?.position,t=s.parentIndex?.position;if(null==e&&null==t)return 0;if(null==t)return 1;if(null==e)return -1;else if(e<t)return -1;else if(e>t)return 1}return es(e,t)}function ei(e,t){let[r,s]=el(e,t);if(r&&s){let{sessionID:e,localID:t}=r.guid??{localID:-1,sessionID:-1},{sessionID:a,localID:i}=s.guid??{localID:-1,sessionID:-1};return e-a||t-i}return ea(e,t)}function en(e,t){return(t.displayProperties.memoryFraction??0)-(e.displayProperties.memoryFraction??0)||ea(e,t)}function el(e,t){return"nodeChange"in e&&"nodeChange"in t?[e.nodeChange,t.nodeChange]:[null,null]}var eo=r(464358),ed=r(911081),ec=r(56829),eu=r(879370),eh=r(590914),ef=r(396837),ep=r(225562);let em=eu.Lt,e_=eu.Wx,eg=eu.Z0;function eb({contextMenuData:{objectId:e,position:t},onClose:r}){let[i,l]=a.useState(0),o=t.left,d=t.top+i>window.innerHeight?t.top-i:t.top,{canSelectInApp:c,selectInApp:p}=a.useContext(k.pq),m=a.useRef(null);(0,ec.X3)(m,r);let _=(0,n.Dv)(f.Pm).getObject(e),g=_ instanceof ep.o?_:null,b=_ instanceof ef.S?_:null,[x,y]=(0,n.KO)(h.km),v=(0,n.b9)($);if(null==_)return null;let j=e=>()=>{e(),r()},I=_.children.length>0,C=(()=>{if(c?.(_))return j(()=>p(_))})(),w=e=>j(()=>D.iTB.triggerAction(e,{guid:_.id})),S=x?.object.id===_.id;return(0,s.jsx)(em,{style:{...u.sx.fixed.$,left:o,top:d},dropdownRef:e=>{e&&l(e.clientHeight)},children:(0,s.jsxs)("div",{ref:m,children:[C&&(0,s.jsx)(e_,{onClick:C,children:"Jump to node"}),I&&(0,s.jsx)(e_,{onClick:j(()=>v({type:"expandDescendants",objectId:e})),children:"Expand descendants"}),I&&(0,s.jsx)(e_,{onClick:j(()=>v({type:"collapseDescendants",objectId:e})),children:"Collapse descendants"}),(C||I)&&(0,s.jsx)(eg,{}),S&&(0,s.jsx)(e_,{onClick:j(()=>y({type:"clear"})),children:"Stop diffing against this node"}),(!S||x?.type!==h.RT.Layer)&&(0,s.jsx)(e_,{onClick:j(()=>y({type:"start",diffType:h.RT.Layer,id:e})),children:"Layer diff against this node"}),(!S||x?.type!==h.RT.Tree)&&(0,s.jsx)(e_,{onClick:j(()=>y({type:"start",diffType:h.RT.Tree,id:e})),children:"Tree diff against this node"}),g&&(0,s.jsx)(eg,{}),g&&(0,s.jsx)(e_,{onClick:j(()=>{let e=JSON.stringify(g.nodeChange,null,2);navigator.clipboard.writeText(e)}),children:"Copy NodeChange JSON"}),b&&"DOCUMENT"!==b.type&&"CANVAS"!==b.type&&(0,s.jsx)(e_,{onClick:w("debug-print-as-test-code"),children:(0,eh.tx)("fullscreen_actions.debug-print-as-test-code")}),b&&"VECTOR"===b.type&&(0,s.jsx)(e_,{onClick:w("debug-print-vector-network-as-test-code"),children:(0,eh.tx)("fullscreen_actions.debug-print-vector-network-as-test-code")})]})})}var ex=r(886240);let ey=a.memo(function({diffType:e,id:t,primaryId:r,secondaryId:i,leftBadges:n,indent:l,index:o,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:h,memoryFraction:f,rightBadges:p,name:m,style:_,select:g,toggle:b,showContextMenu:x}){let y=a.useCallback(e=>{e.preventDefault(),x({objectId:t,position:{left:e.clientX,top:e.clientY}})},[t,x]);return(0,s.jsxs)(ex.a,{changeType:e,indent:l,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:h,keyboardNavigationPath:[o],onContextMenu:y,onMouseEnter:()=>{D.O$1&&D.O$1.editorState().figmaScopeHighlightedNode.set(t)},onMouseLeave:()=>{D.O$1&&D.O$1.editorState().figmaScopeHighlightedNode.set("")},select:()=>g(t),style:_,toggleExpanded:e=>b(t,e),children:[(0,s.jsx)(eo.NY,{badges:n}),(0,s.jsx)(ed.Be,{id:r}),i&&(0,s.jsx)(ed.Be,{id:i,secondary:!0}),(0,s.jsx)("div",{title:m,className:P.B.ellipsis.noWrap.overflowHidden.$,children:m}),(0,s.jsx)(O.m,{}),(0,s.jsx)(eo.NY,{badges:p}),null!=f&&(0,s.jsxs)("span",{className:P.B.colorTextSecondary.$,title:"Node memory usage",children:[(100*f).toFixed(3),"%"]})]})});function ev({style:e,data:{displayedObjects:t,selectedId:r,selectedIds:a,...i},index:n}){let l=t[n],o=(0,N.SH)(e);return(0,s.jsx)(ey,{...l,...i,isSelected:r===l.id,isSelectedSecondary:!!l&&a.includes(l.id),style:o,index:n})}let ej=[];function ek({appSelection:e}){let t=(0,n.Dv)(eI),[r,i]=(0,n.KO)(k.tz),l=(0,N.vE)(()=>e?.guids??ej,[e?.guids]),[o,d]=a.useState(null),c=a.useRef(null);a.useEffect(()=>{let e=t.findIndex(e=>e.id===r);e>=0&&c.current?.scrollToItem(e,"smart")},[t,r]);let u=(0,n.b9)($);a.useEffect(()=>{u({type:"expandAncestors",objectId:r})},[u,r]);let h=a.useCallback((e,t)=>{u({type:"toggleExpanded",objectId:e,toggleSubtree:t})},[u]),f=(0,n.Dv)(X);return 0===t.length?(0,s.jsx)("div",{children:f??"Empty Scene"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.Z,{disableWidth:!0,children:({height:e})=>(0,s.jsx)(S.t7,{itemSize:18,itemCount:t.length,height:e,ref:c,itemData:{displayedObjects:t,selectedId:r,selectedIds:l,select:i,toggle:h,showContextMenu:d},width:"100%",children:ev})}),o&&(0,s.jsx)(eb,{contextMenuData:o,onClose:()=>{d(null)}})]})}let eI=(0,n.cn)(e=>{let t=e(A),r=e(f.Pm);return(e(eC)??e(ew)).map(e=>({...e,rightBadges:[...e.rightBadges,...t.has(e.id)?[{type:"bookmark",value:"Bookmarked"}]:[],...r.getAdditionalBadges?.(e.id)||[]]}))}),eC=(0,n.cn)(e=>{let t=e(q);return t?t.map(e=>({...e.displayProperties,diffType:void 0,id:e.id,indent:0,isExpanded:!1,isLeaf:!0})):null}),ew=(0,n.cn)(e=>{let t=e(f.Pm).rootObjects,r=e(h.jR),s=e($),a=e(er),i=(()=>{switch(r.type){case h.RT.Tree:return[r.object];case h.RT.Full:return r.resource.rootObjects;default:return[]}})(),n={sortFn:a,expandedIds:s};return T()(t,e=>{if(!e)return[];if(0===i.length)return eS(e,0,n);let t=eD(e,i);return t?eE(e,t,0,n):function e(t,r,s,a){let i=t.id,n=t.children,l=0===n.length,o=!!a.expandedIds[i],d=!1,c=T()(n,t=>{let i=(()=>{let i=eD(t,r);if(i)return eE(t,i,s+1,a);let n=r.filter(e=>e.someAncestor(e=>e.id===t.id,{includeSelf:!0}));return n.length>0?e(t,n,s+1,a):eS(t,s+1,a)})();return d=d||i[0]?.diffType!=null,i}),u={...t.displayProperties,diffType:d?"CHILD_MODIFIED":void 0,id:i,indent:s,isExpanded:o,isLeaf:l};return o?[u,...c]:[u]}(e,i,0,n)})});function eS(e,t,r){let s=e.id,a=e.children,i=0===a.length,n=!!r.expandedIds[s],l={...e.displayProperties,diffType:void 0,id:s,indent:t,isExpanded:n,isLeaf:i};return n?[l,...T()(eN(a,r.sortFn),e=>eS(e,t+1,r))]:[l]}function eE(e,t,r,s){let a=e??t;if(!a)throw Error("Diffing two nothings");if(e&&t&&e.id!==t.id)throw Error("Diffing nodes with mismatched keys");let i=a.id,n=eN(e?.children??[],s.sortFn),l=eN(t?.children??[],s.sortFn),o=(0,E.eG)(n,l,e=>e.id),d=!1,c=T()(o,({left:e,right:t})=>{let a=eE(e,t,r+1,s);return d=d||a[0]?.diffType!=null,a}),u=(0,h.iB)(e,t,d),f=e?.displayProperties.name,p=t?.displayProperties.name,m=null!=f&&null!=p&&f!==p?`${f} <=> ${p}`:a.displayProperties.name,_=!!s.expandedIds[i],g={...a.displayProperties,diffType:u,id:i,indent:r,isExpanded:_,isLeaf:0===o.length,name:m};return _?[g,...c]:[g]}function eD(e,t){return t.find(t=>t.id===e.id)}function eN(e,t){return e.slice().sort(t)}var eF=r(211839),eT=r(410802),eP=r(642170);r(607906);var eO=r(711169),eM=r(317429),eR=r(282906),eA=r(244465),eB=r(682289),eL=r(473550),eV=r(172592),e$=r(276637),ez=r(913206),eU=r(981744);function eG(e){let{bookmarks:t,deleteBookmark:r,moveBookmarkDown:i,moveBookmarkUp:n,renameBookmark:l,updateBookmarkId:o}=B();return(0,s.jsx)(eO.fC,{defaultPosition:{x:window.innerWidth/2,y:window.innerHeight/2},onClose:e.onClose,width:400,children:(0,s.jsxs)(eM.AU,{children:[(0,s.jsx)(eM.h4,{children:(0,s.jsx)(eM.Dx,{children:"FigmaScope Bookmarks"})}),(0,s.jsx)(eM.uT,{children:(0,s.jsxs)(eR.fC,{...{className:"xrvj5dj x1nfngrj"},children:[0===t.length&&(0,s.jsx)("div",{className:"x6s0dn4 x78zum5 xpyat2d xl56j7k",children:"No bookmarks"}),t.length>0&&(0,s.jsxs)(eA.X2,{...{className:"xrvj5dj xuhvigx xg2d0mh"},children:[(0,s.jsx)(eB.bL,{children:"Name"}),(0,s.jsx)(eB.bL,{children:"ID"})]}),t.map((e,d)=>(0,a.createElement)(eA.X2,{className:"xrvj5dj xuhvigx xg2d0mh",key:d},(0,s.jsx)(eB.bL,{children:(0,s.jsx)(eL.I,{id:`edit-bookmark-name-${d}`,value:e.name,onChange:e=>l(d,e)})}),(0,s.jsx)(eB.bL,{children:(0,s.jsx)(eL.I,{id:`edit-bookmark-id-${d}`,value:e.id,onChange:e=>o(d,e)})}),(0,s.jsx)(eB.bL,{children:(0,s.jsxs)(eV.h,{"aria-label":`Bookmark actions for ${e.name}`,children:[(0,s.jsx)(eT.h,{"aria-label":"Delete bookmark",onClick:()=>r(d),children:(0,s.jsx)(e$.n,{})}),(0,s.jsx)(eT.h,{"aria-label":"Move bookmark up",disabled:0===d,onClick:()=>n(d),children:(0,s.jsx)(ez.g,{})}),(0,s.jsx)(eT.h,{"aria-label":"Move bookmark down",disabled:d===t.length-1,onClick:()=>i(d),children:(0,s.jsx)(eU.T,{})})]})})))]})})]})})}function eH(){let[e,t]=(0,n.KO)(k.tz),r=(0,n.Dv)(k.g_),{getTriggerProps:i,manager:l}=eF.H9(),{addBookmark:o,bookmarks:d}=B(),[c,u]=a.useState(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eF.fC,{manager:l,children:[(0,s.jsx)("div",{...{className:"xrybvsa"},children:(0,s.jsx)(eT.h,{...i(),"aria-label":"bookmarks",children:(0,s.jsx)(eP.N,{})})}),(0,s.jsxs)(eF.W2,{children:[(0,s.jsxs)(eF.ZA,{title:(0,s.jsx)(eF.Tv,{children:"Bookmark settings"}),children:[(0,s.jsx)(eF.ck,{onClick:()=>{let t=r?.displayProperties.name??"Bookmark";o(e,`${t} - ${e}`)},children:"Add bookmark"}),(0,s.jsx)(eF.ck,{onClick:()=>{u(!0)},children:"Manage bookmarks"})]}),d.length?(0,s.jsx)(eF.ZA,{title:(0,s.jsx)(eF.Tv,{children:"Bookmark list"}),children:d.map((e,r)=>(0,s.jsx)(eF.ck,{onClick:()=>{t(e.id)},children:e.name},r))}):null]})]}),c&&(0,s.jsx)(eG,{onClose:()=>u(!1)})]})}var eK=r(53022),eQ=r.n(eK),eW=r(456252),eZ=r(280585);function eY({searchRef:e}){let t=(0,n.b9)(k.tz),r=(0,n.Dv)(Y),i=(0,n.Dv)(J),[l,o]=a.useState(!1),d=(0,n.Dv)(Z)!==I.d5.Filter&&l,c=a.useRef(null);(0,ec.X3)(c,()=>o(!1));let u=a.useCallback(e=>{o(!1),t(e.object.id)},[o,t]);return(0,s.jsxs)(eZ.Sg,{className:P.B.flex1.$,ref:c,allowVim:!0,children:[(0,s.jsx)(eJ,{searchRef:e,setShowSearchResults:o}),d&&(r?(0,s.jsx)(eX,{searchResults:r,selectResult:u}):i?(0,s.jsx)(e0,{text:i}):null)]})}function eJ({searchRef:e,setShowSearchResults:t}){let r=(0,n.Dv)(Z),i=function(){let e=(0,n.Dv)(f.Pm),t=(0,n.b9)(H),r=(0,n.b9)(K),s=(0,n.b9)(Q),i=a.useRef(0),l=a.useMemo(()=>(0,z.D)(a=>{let n=++i.current;s(!0);let l=new TaskController({priority:"user-visible"});scheduler.postTask(()=>s(!0),{signal:l.signal,delay:300}).catch(()=>{});let o=e.getObject(a);o&&t({status:"searching",results:[{object:o,matches:[{value:a,property:"id",isExact:!0}]}]}),e.getSearch(r).then(e=>e.searchWithText(a)).then(e=>{l.abort(),n===i.current&&t({status:"success",results:e})}).catch(e=>{console.error(e),l.abort(),n===i.current&&t({status:"error",error:e})})},200),[e,r,t,s]);return a.useCallback(e=>0===e.length?t({status:"initial"}):l(e),[l,t])}(),{setKeyboardNavigationElement:l}=(0,eZ.Jd)({path:[0,0],id:"input"});return(0,s.jsx)("input",{ref:t=>{l(t),e.current=t},type:"text",placeholder:r,className:"search_bar--searchBar--UMQA-",onChange:e=>i(e.target.value),onFocus:()=>t(!0)})}function eq({children:e}){return(0,s.jsx)("div",{className:P.B.absolute.zIndexModal.colorBg.b1.colorBorder.mt2.overflowAuto.$,style:{maxHeight:450,minWidth:500,boxShadow:"0px 2px 14px var(--color-shadow, rgba(0, 0, 0, 0.15))"},children:e})}function eX({searchResults:e,selectResult:t}){return(0,s.jsx)(eq,{children:e.map((e,r)=>(0,s.jsx)(e1,{result:e,index:r,onClick:()=>t(e)},e.object.id))})}function e0({text:e}){return(0,s.jsx)(eq,{children:(Array.isArray(e)?e:[e]).map((e,t)=>(0,s.jsx)("div",{className:P.B.colorBg.colorTextSecondary.px8.py4.$,children:e},t))})}function e1({result:e,index:t,onClick:r}){let{object:i,matches:n}=e,{displayProperties:l}=i,{setKeyboardNavigationElement:o,keyboardNavigationItem:d,isFauxFocused:c}=(0,eZ.Jd)({path:[1,t],id:i.id});return a.useEffect(()=>{d&&0===t&&d.fauxFocus()},[d,t]),(0,s.jsx)("button",{ref:o,className:eQ()(P.B.block.wFull.px4.py8.colorText.flex.itemsCenter.alignLeft.$,"search_bar--searchResult--8iGr1",c&&"search_bar--fauxFocus--6i7Gb"),onClick:r,children:(0,s.jsxs)(O.j,{spacing:4,children:[(0,s.jsx)(eo.NY,{badges:l.leftBadges}),(0,s.jsx)(ed.Be,{id:i.displayProperties.primaryId}),(0,s.jsx)(eW.C,{className:P.B.overflowHidden.$,text:l.name}),(0,s.jsx)(O.m,{}),n.filter(({property:e})=>!["id","guid","name","type","phase"].includes(e)).map(({property:e,value:t},r)=>(0,s.jsxs)(O.j,{spacing:4,width:"hug-contents",children:[(0,s.jsxs)("div",{children:[e,":"]}),(0,s.jsx)("div",{children:t})]},r))]})})}var e5=r(240473);function e9({children:e}){return(0,s.jsx)("div",{className:P.B.colorBorder.px8.py4.bb1.bSolid.$,children:(0,s.jsx)(O.j,{children:e})})}function e2(e){let t={className:"toolbar_components--iconButton--h3x8J",children:(0,s.jsx)(e5.n,{svg:e.svg}),title:e.label,"aria-label":e.label};return"href"in e?(0,s.jsx)("a",{...t,href:e.href,target:"blank"}):(0,s.jsx)("button",{...t,onClick:e.onClick,disabled:e.disabled})}var e7=r(632059),e4=r(261051);function e3({searchRef:e}){let[t,r]=(0,n.KO)(k.md),[i,o]=(0,n.KO)(k.L3),d=!!a.useContext(k.pq).selectInApp,[c,u]=(0,n.KO)(Z),[h,f]=(0,n.KO)(k.E4),[p,m]=(0,n.KO)(ee),_=(0,n.Dv)(et);return(0,s.jsxs)(e9,{children:[(0,s.jsx)(eY,{searchRef:e}),(0,s.jsxs)("select",{name:"filter-or-search",title:"Determines whether the text box searches or filters",onChange:e=>{u(e.target.value)},defaultValue:c,children:[(0,s.jsx)("option",{value:I.d5.Search,children:"Search"}),(0,s.jsx)("option",{value:I.d5.Filter,children:"Filter"})]}),(0,s.jsx)("select",{name:"sort",title:"Sets the left panel sort order",onChange:e=>{let t=e.target.value;l.RQ.trackDefinedEvent("figmascope.sort_order_change",{order:function(e){switch(e){case I.Mf.Position:return"position";case I.Mf.Name:return"name";case I.Mf.Memory:return"memory";case I.Mf.NodeId:return"node_id"}}(t)}),m(t)},defaultValue:p,children:_.map(e=>(0,s.jsxs)("option",{value:e,children:["Sort by ",e]},e))}),d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{name:"follow-selection",type:"checkbox",checked:h,onChange:e=>f(e.target.checked)}),(0,s.jsx)("label",{htmlFor:"follow-selection",children:"Follow"})]}),(0,s.jsx)(e2,{label:"Select Previous",onClick:()=>{r(),l.RQ.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"button"})},disabled:!t,svg:e7.Z}),(0,s.jsx)(e2,{label:"Select Next",onClick:()=>{o(),l.RQ.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"button"})},disabled:!i,svg:e4.Z}),(0,s.jsx)(eH,{})]})}var e6=r(503812),e8=r(18715),te=r(739842),tt=r(370452),tr=r(185063),ts=r(408600),ta=r(956555),ti=r(384787);function tn({selectedObject:e,diffObject:t,onClose:r}){let a=(0,n.Dv)(y),[i,l]=(0,n.KO)(h.km);return(0,s.jsxs)(e9,{children:[e?i&&t?(0,s.jsx)(td,{selectedObject:e,diffObject:t,diffState:i,setDiffState:l}):(0,s.jsx)(to,{object:e}):t?(0,s.jsx)(to,{object:t}):(0,s.jsx)(O.m,{}),a&&(0,s.jsx)(tc,{}),(0,s.jsx)(e2,{label:"Help",href:tt.T,svg:tr.Z}),r&&(0,s.jsx)(e2,{label:"Close FigmaScope",onClick:r,svg:ti.Z})]})}let tl=P.B.flex1.ml10.my4.$;function to({object:e}){return(0,s.jsx)("div",{className:tl,children:(0,s.jsx)("span",{className:P.B.fontSemiBold.$,children:e.displayProperties.longName})})}function td({selectedObject:e,diffObject:t,diffState:r,setDiffState:a}){let i=(0,n.b9)(k.tz);return(0,s.jsxs)("div",{className:P.B.flex1.ml10.my4.$,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:P.B.colorTextSecondary.$,children:"Diffing "}),(0,s.jsx)("span",{className:P.B.fontSemiBold.$,children:e.displayProperties.longName}),(0,s.jsx)("span",{className:P.B.colorTextSecondary.$,children:" against "}),(0,s.jsx)("span",{className:P.B.fontSemiBold.$,children:t.displayProperties.longName})]}),r&&(0,s.jsx)("div",{className:P.B.colorTextSecondary.mt8.$,children:(0,s.jsxs)(O.j,{spacing:8,width:"hug-contents",height:"hug-contents",verticalAlignItems:"start",children:[(0,s.jsxs)("span",{children:["Snapshot of"," ",(0,s.jsx)(te.UU,{onClick:()=>i(r.object.id),className:P.B.colorTextFigjam.fontSemiBold.$,trusted:!0,children:r.object.displayProperties.name}),r.type===h.RT.Tree&&" and full subtree"," was taken at"," ",r.time.toLocaleTimeString("en-US")]}),(0,s.jsx)(te.UU,{onClick:()=>a({type:"refresh"}),className:P.B.colorTextDesign.$,trusted:!0,children:"Refresh"}),(0,s.jsx)(te.UU,{onClick:()=>a({type:"clear"}),className:P.B.colorTextDanger.$,trusted:!0,children:"Finish"})]})})]})}function tc(){let[e,t]=(0,n.KO)(v),r=e.status===c.Q.LOADING;return a.useEffect(()=>{t()},[t]),(0,s.jsx)(e2,{label:r?"Fetching scene graph validation failures":"Refetch scenegraph validation failures",onClick:t,svg:r?ts.Z:ta.Z})}var tu=r(225094);function th({children:e}){return(0,s.jsx)("div",{className:P.B.hFull.$,children:(0,s.jsxs)(O.j,{direction:"vertical",width:"fill-parent",height:"fill-parent",padding:0,spacing:0,children:[(0,s.jsx)(tf,{}),e]})})}function tf(){let{name:e,metadata:t}=(0,n.Dv)(f.Pm);return(0,s.jsxs)(O.j,{direction:"horizontal",width:"fill-parent",height:32,padding:8,spacing:32,backgroundColor:"toolbar",children:[e&&(0,s.jsx)(tu.x,{fontWeight:"bold",color:"toolbar",children:e}),t&&Object.entries(t).map(([e,t])=>t&&(0,s.jsxs)("span",{children:[(0,s.jsxs)(tu.x,{color:"toolbar-secondary",children:[e,": "]}),(0,s.jsx)(tu.x,{color:"toolbar",fontFamily:"monospace",fontWeight:"bold",children:t})]},e))]})}var tp=r(221325);let tm=a.memo(function({embedded:e=!1,emptyStateContent:t,onClose:r,appSelection:a,setAppSelection:i}){let l=(0,n.Dv)(f.O7);switch(l.status){case c.Q.INIT:return t??(0,s.jsx)(C.x,{});case c.Q.LOADING:return(0,s.jsx)(C.x,{});case c.Q.FAILURE:return(0,s.jsx)(C.kI,{error:l.error});case c.Q.SUCCESS:}if(0===l.value.primaryResource.rootObjects.length)return(0,s.jsx)(C.kI,{error:"No root objects found. This is likely a bug - please report in #figmascope."});let o=(0,s.jsx)(t_,{appSelection:a,setAppSelection:i,onClose:r});return e?o:(0,s.jsx)(th,{children:o})});function t_({onClose:e,appSelection:t,setAppSelection:r}){let p=a.useRef(null),m=a.useRef(null),{windowInnerWidth:_}=(0,o.i)(),[g,b]=(0,n.KO)(tg),[x,y]=(0,n.KO)(tb),[j,I]=(0,i.c)({onDrag(e){let t=e.clientX/_;b(`${(100*t).toFixed(2)}%`)}}),[C,w]=(0,i.c)({onDrag(e){let t=m.current;if(!t)return;let r=(e.clientX-t.getBoundingClientRect().left)/t.clientWidth;y(`${(100*r).toFixed(2)}%`)}}),S=(0,n.b9)(k.md),E=(0,n.b9)(k.L3),D=a.useCallback(e=>{let t=p.current;document.activeElement!==t&&(e.keyCode===d.sr.FORWARD_SLASH&&t?(t.focus(),e.preventDefault()):e.keyCode===d.sr.BRACKET_LEFT?(l.RQ.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"keyboard"}),S()):e.keyCode===d.sr.BRACKET_RIGHT&&(l.RQ.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"keyboard"}),E()))},[S,E]),N=(0,n.Dv)(f.Pm);window.figmaScope=N,window.figmaScopeScene=N;let[F,T]=(0,n.KO)(v);F.status===c.Q.SUCCESS&&N?.setSceneGraphValidationInfo?.(F.value),(0,a.useEffect)(()=>{T()},[T]);let P=(0,n.Dv)(k.tz),O=(0,n.Dv)(k.g_),M=(0,n.Dv)(h.aS);return(0,s.jsx)(k.gM,{appSelection:t,setAppSelection:r,children:(0,s.jsxs)("div",{className:tp.Jz,style:u.sx.if(j||C,{cursor:"ew-resize"}).$,onKeyDown:D,children:[(0,s.jsxs)("div",{className:tp.CH,style:{width:g},children:[(0,s.jsx)(e3,{searchRef:p}),(0,s.jsxs)(e6.W,{className:tp.W0,children:[(0,s.jsx)("div",{...I({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,s.jsx)(ek,{appSelection:t})]})]}),(0,s.jsxs)("div",{className:tp.Hs,children:[(0,s.jsx)(tn,{selectedObject:O,diffObject:M,onClose:e}),(O||M)&&(0,s.jsxs)("div",{className:tp.m8,ref:m,children:[(0,s.jsxs)(e6.W,{className:tp.to,style:{width:x},children:[(0,s.jsx)("div",{...w({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,s.jsx)(e8.a,{panel:"middle",items:O?.rawProperties,diffItems:M?.rawProperties,extraItems:void 0},P)]}),(0,s.jsx)(e6.W,{className:tp.wB,children:(0,s.jsx)(e8.a,{panel:"right",items:O?.computedProperties,diffItems:M?.computedProperties,extraItems:N.getAdditionalProperties?.(P)},P)})]})]})]})})}let tg=(0,I.D2)("leftPanelWidth","35%"),tb=(0,I.D2)("rightPanelWidth","50%")},596966:function(e,t,r){r.d(t,{R:()=>d});var s=r(763250),a=r(997535),i=r(594170),n=r(379586),l=r(810334);let o=new Map,d=(0,l.t)(async e=>{let{fileKey:t,context:r,plan:l}=e,d="ai_assistant"===r?a.hn:a.IV,c=l.planRecordId;if(!c){let e="No plan record id, cannot create thread";return(0,a.WX)(new d(e),"create_thread_record",{fileKey:t}),{status:"error",error:e}}let u=async()=>{let l=i.l.createVital(`${r}.chat_sdk.thread_creation_time`,{level:s.in.INFO});l.start();let o=await (0,a.at)(l,()=>n.oG.createThread({fileKey:t,planId:c,privacyMode:"code_chat"===r?"file":"user",nodeGuid:"code_chat"===r?e.isOldFile?"old_file":e.nodeGuid:void 0}));if(l.stop(),!o.success){let{statusCode:e,cause:r,errorData:s}=o,i=`ApiAiChat.createThread failed, status: ${e}`;return(0,a.WX)(new d(i),"create_thread_record",{fileKey:t,statusCode:e,cause:r,errorData:s}),{status:"error",error:i}}return o.data.meta.alreadyExists&&(0,a.WX)(new d("ApiAiChat.createThread succeeded but thread already exists"),"create_thread_record",{fileKey:t,threadId:o.data.meta.threadId}),{status:"created",threadId:o.data.meta.threadId,isOldFile:"code_chat"===r&&e.isOldFile}};if("code_chat"!==r)return await u();{let s=`${t}:${r}:${e.nodeGuid}`;return await function(e,t){let r=o.get(e);if(r)return r;let s=(async()=>{try{return await t()}finally{o.delete(e)}})();return o.set(e,s),s}(s,u)}})},978029:function(e,t,r){if(r.d(t,{r:()=>a}),9793==r.j)var s=r(50175);function a(e){return"org"===e.tier||"enterprise"===e.tier?(0,s.D)("make_chat_sdk_phase1_org"):"pro"===e.tier||"student"===e.tier?(0,s.D)("make_chat_sdk_phase1_pro"):(0,s.D)("make_chat_sdk_phase1_starter")}},835847:function(e,t,r){r.d(t,{Jt:()=>g,Yj:()=>_,od:()=>p,p2:()=>m});var s=r(853505),a=r(577774),i=r(596966);if(9793==r.j)var n=r(978029);var l=r(983166),o=r(997535),d=r(416792),c=r(723819);if(9793==r.j)var u=r(50175);if(9793==r.j)var h=r(271609);if(9793==r.j)var f=r(892552);function p(e,t){let r=m({overrideCodeLibraryNode:e===a.I$.FIGMAKE?t:null,disabled:e!==a.I$.FIGMAKE}),s=_({codeFileNode:e===a.I$.CODE_IN_SITES?t:null,disabled:e!==a.I$.CODE_IN_SITES}),i=g({codeFileNode:e===a.I$.FIGMAKE_IN_DESIGN?t:null,disabled:e!==a.I$.FIGMAKE_IN_DESIGN});switch(e){case a.I$.FIGMAKE:return r;case a.I$.CODE_IN_SITES:return s;case a.I$.FIGMAKE_IN_DESIGN:return i;default:throw Error(`Unsupported feature type: ${e}`)}}function m({overrideCodeLibraryNode:e,disabled:t}){let{codeLibraryInstance:r}=(0,h.pG)(),p=t?null:void 0!==e?e:r,m=(0,d.CA)(),_=m?.key??null,g=!!m?.canEdit,{status:b,data:x}=(0,c.Qy)(_),y="loaded"===b,v=(0,f.f3)(p),j=(0,f.M9)(p),k=!!(y&&x&&(0,n.r)(x)),{chatSdkState:I,chatSdkStatus:C}=function({fileKey:e,userCanEditFile:t,shouldQueryChatSdkState:r,chatMessagesNode:a,plan:n,nodeSource:d}){let c=s.useRef(!1),u=a?.guid||"",{threadId:h,isOldFile:f,subscriptionStatus:p}=(0,l.Me)({isEnabled:!!(r&&e&&u),fileKey:e,nodeGuid:u}),m=f??d.getMessages().length>0,_=s.useRef(e),g=s.useRef(u),[b,x]=s.useState({threadId:h,isOldFile:m,errorOnCreateThread:!1}),y=null!==h&&(h!==b?.threadId||m!==b?.isOldFile),v=e!==_.current||u!==g.current;(y||v)&&(_.current=e,g.current=u,x({threadId:h,isOldFile:m,errorOnCreateThread:!1}));let j=e&&u&&"loaded"===p&&n&&r,k=j&&!t&&null===h;return j&&null===h&&t&&!c.current&&(c.current=!0,(0,i.R)({context:"code_chat",fileKey:e,plan:n,nodeGuid:u,isOldFile:m}).then(e=>{if("error"===e.status&&x({threadId:null,isOldFile:null,errorOnCreateThread:!0}),"created"===e.status){let{threadId:t,isOldFile:r}=e;(0,o.Wv)(`Figmake AiChatThread created, id: ${t}, isOldFile?: ${r}`),x({threadId:t,isOldFile:r,errorOnCreateThread:!1})}})),s.useMemo(()=>{let{threadId:e,isOldFile:t,errorOnCreateThread:r}=b,s=p;return(r?s="errors":k&&(s="disabled"),e&&null!=t)?{chatSdkState:{threadId:e,isOldFile:t},chatSdkStatus:s}:{chatSdkState:void 0,chatSdkStatus:s}},[b,p,k])}({fileKey:_,userCanEditFile:g,chatMessagesNode:p,plan:x,shouldQueryChatSdkState:k,nodeSource:v}),w=k&&"errors"!==C&&"disabled"!==C,S=w&&(0,u.D)("make_chat_sdk_read")&&(!I?.isOldFile||(0,u.D)("make_chat_sdk_read_old_files"))&&((0,u.D)("make_chat_sdk_read_pagination")||v.getMessages().length<100);return s.useMemo(()=>{let e=S?j:v,t=[v];w&&t.push(j);let r=!!(y&&p&&(!w||I));return new a.V0({readingSource:e,writingSinks:t,isInitialized:r,node:p,chatSdkState:I,chatSdkPhase1Enabled:w,nodeChatSource:v})},[p,v,j,S,I,w,y])}function _({codeFileNode:e,disabled:t}){let r=t?null:e,i=(0,f.f3)(r);return s.useMemo(()=>new a.V0({readingSource:i,writingSinks:[i],node:r,chatSdkPhase1Enabled:!1,isInitialized:!!r}),[i,r])}function g({codeFileNode:e,disabled:t}){let r=t?null:e,i=(0,f.f3)(r);return s.useMemo(()=>new a.V0({readingSource:i,writingSinks:[i],node:r,chatSdkPhase1Enabled:!1,isInitialized:!!r}),[i,r])}},452549:function(e,t,r){if(r.d(t,{D:()=>f}),9793==r.j)var s=r(850340);var a=r(273634),i=r(296753),n=r.n(i),l=r(918026),o=r(594170),d=r(260251);let c=9793==r.j?{code_bundle_start:null,code_bundle_stop:null,preview_website_bundle_start:null,preview_website_bundle_stop:null,asset_generation_start:null,asset_generation_stop:null,render_start:null,render_stop:null,sandbox_create_start:null,sandbox_create_stop:null,files_patch_start:null,files_patch_stop:null,update_package_json_start:null,update_package_json_stop:null,install_dependencies_start:null,install_dependencies_stop:null,import_module_start:null,import_module_stop:null,cached_preview_urls_load_start:null,cached_preview_urls_load_stop:null,cached_preview_iframe_load_start:null,cached_preview_iframe_load_stop:null}:null,u=9793==r.j?{code_bundle_start:null,preview_website_bundle_start:null,asset_generation_start:null,render_start:null,sandbox_create_start:null,files_patch_start:null,update_package_json_start:null,install_dependencies_start:null,import_module_start:null,cached_preview_urls_load_start:null,cached_preview_iframe_load_start:null}:null;function h({start:e,stop:t}){return Math.max(0,e&&t&&t-e||0)}class f{constructor({isFoundry:e}){this.initTime=null,this.userFlow=null,this.buildMetadata=null,this.loadMetadata={},this.syncMetadata={},this.durationVitalMap={...u},this.timingMap={...c},this.isFirstBuild=!0,this.isFoundry=e}reset(){this.timingMap={...c},this.durationVitalMap={...u},this.initTime=null,this.userFlow=null,this.isFirstBuild=!1,this.buildMetadata=null,this.loadMetadata={}}record(e){this.initTime||(this.initTime=performance.now()),this.userFlow||(this.userFlow=o.l.startUserFlow({name:"component_preview",team:a.k.MAKE,context:{is_foundry:this.isFoundry,is_first_build:this.isFirstBuild}})),null===this.timingMap[e]&&(this.recordDurationVital(e),this.timingMap[e]=performance.now())}recordDurationVital(e){if(this.userFlow)switch(e){case"code_bundle_start":case"preview_website_bundle_start":case"asset_generation_start":case"render_start":case"sandbox_create_start":case"files_patch_start":case"update_package_json_start":case"install_dependencies_start":case"import_module_start":case"cached_preview_urls_load_start":case"cached_preview_iframe_load_start":let t=this.userFlow.startDuration(e.replace("_start",""));t.addContext({is_foundry:this.isFoundry,is_first_build:this.isFirstBuild}),this.durationVitalMap[e]=t;break;case"code_bundle_stop":case"preview_website_bundle_stop":case"asset_generation_stop":case"render_stop":case"sandbox_create_stop":case"files_patch_stop":case"update_package_json_stop":case"install_dependencies_stop":case"import_module_stop":case"cached_preview_urls_load_stop":case"cached_preview_iframe_load_stop":let r=e.replace("_stop","_start");this.durationVitalMap[r]?.stop(),this.durationVitalMap[r]=null;break;default:(0,s.jT)(e,null)}}setBuildMetadata(e){this.buildMetadata=e}setLoadMetadata(e){this.loadMetadata={...this.loadMetadata,...e}}setSyncMetadata(e){this.syncMetadata={...this.syncMetadata,...e}}trackFigmentEvent(){let{code_bundle_start:e,code_bundle_stop:t,preview_website_bundle_start:r,preview_website_bundle_stop:s,asset_generation_start:a,asset_generation_stop:i,render_start:o,render_stop:c,sandbox_create_start:u,sandbox_create_stop:f,files_patch_start:p,files_patch_stop:m,update_package_json_start:_,update_package_json_stop:g,install_dependencies_start:b,install_dependencies_stop:x,import_module_start:y,import_module_stop:v,cached_preview_urls_load_start:j,cached_preview_urls_load_stop:k,cached_preview_iframe_load_start:I,cached_preview_iframe_load_stop:C}=this.timingMap;if(!this.initTime)return void console.error("Component preview performance tracker init time not set. Unable to track figment event.");let w=l.V.getState(),S=(this.buildMetadata?.isBuildSuccessful||this.isFoundry?c:t)??performance.now();(0,d.hp)("code_component_preview_perf",w.openFile?.key,n()(w,["selectedView","fileByKey"]),{is_foundry:this.isFoundry,total_build_and_render_ms:h({start:this.initTime,stop:S}),bundle_code_ms:h({start:e,stop:t}),preview_website_bundle_ms:h({start:r,stop:s}),asset_generation_ms:h({start:a,stop:i}),render_ms:h({start:o,stop:c}),sandbox_create_ms:h({start:u,stop:f}),files_patch_ms:h({start:p,stop:m}),update_package_json_ms:h({start:_,stop:g}),install_dependencies_ms:h({start:b,stop:x}),import_module_ms:h({start:y,stop:v}),cached_preview_urls_load_ms:h({start:j,stop:k}),cached_preview_iframe_load_ms:h({start:I,stop:C}),npm_install_duration_ms:this.syncMetadata?.npmInstallDuration??0,is_first_build:this.isFirstBuild,is_build_successful:this.buildMetadata?.isBuildSuccessful,is_cached_preview_urls_load_successful:this.loadMetadata?.isCachedPreviewUrlsLoadSuccessful,newly_provisioned:this.loadMetadata?.newlyProvisioned,error_message:this.buildMetadata?.errorMessage,bundle_js_length:this.buildMetadata?.bundleJsLength,bundle_css_length:this.buildMetadata?.bundleCssLength,total_library_code_files:this.buildMetadata?.totalCodeFiles,total_library_code_file_lines:this.buildMetadata?.totalCodeFileLines,total_library_image_imports:this.buildMetadata?.totalImageImports,source_code_hash:this.syncMetadata?.sourceCodeHash,is_sync_successful:this.syncMetadata?.isSyncSuccessful},{forwardToDatadog:!0}),this.userFlow?.end(),this.reset()}}},579828:function(e,t,r){r.d(t,{Bi:()=>d,F5:()=>c,JS:()=>p,Mx:()=>l,Ny:()=>f,RV:()=>i,Sg:()=>n,cA:()=>s,kC:()=>u,lK:()=>o,mP:()=>a,sg:()=>h});let s=3e4,a=3,i=1e3,n=6e4,l=500,o=5e3,d=3,c=6e4,u=3,h=1e3,f=6e4,p=9793==r.j?1e4:null},771252:function(e,t,r){r.d(t,{z:()=>w,Z:()=>S});var s,a,i=r(777452),n=r(913838),l=r(546518),o=r(850340),d=r(538362),c=r(389981),u=r(492342),h=r(444947),f=r(574059),p=r(331215),m=r(255966),_=r(785316),g=r(587906),b=r(489617),x=r(408969),y=r(579828),v=r(150042),j=r(91824),k=r.n(j),I=((s=I||{}).ABORTED="ABORTED",s.ALREADY_SYNCING="ALREADY_SYNCING",s.FAILURE="FAILURE",s.NOTHING_TO_SYNC="NOTHING_TO_SYNC",s.SYNCED="SYNCED",s);class C{constructor({entrypointsByIdentifier:e,originHost:t,abortSignal:r,limitRetries:s,codeLibraryFormat:a,perfTracker:i,onSyncFailure:n,onResponse:l}){this.syncedItemsByGuid={},this.queuedItems=[],this.inFlightItems=[],this.sync=(e,t)=>(this.addToQueue(e,t),this.processQueue()),this.entrypointsByIdentifier=e,this.originHost=t,this.abortSignal=r,this.limitRetries=s,this.perfTracker=i,this.codeLibraryFormat=a,this.onSyncFailure=n,this.onResponse=l}addToQueue(e,t){for(let t of e.added)t.metadata.guid&&t.metadata.assetVersion&&this.queuedItems.push({type:"upsert",entry:{path:this.sanitizedPath(t.path),contents:t.contents.toString(),metadata:{version:this.sanitizedVersion(t.metadata.assetVersion),guid:t.metadata.guid}}});for(let t of[...e.updated,...e.moved])t.new.metadata.guid&&t.new.metadata.assetVersion&&this.queuedItems.push({type:"upsert",entry:{path:this.sanitizedPath(t.new.path),contents:t.new.contents.toString(),metadata:{version:this.sanitizedVersion(t.new.metadata.assetVersion),guid:t.new.metadata.guid}}});for(let t of e.removed)t.metadata.guid&&t.metadata.assetVersion&&this.queuedItems.push({type:"delete",entry:{path:this.sanitizedPath(t.path),metadata:{version:this.sanitizedVersion(t.metadata.assetVersion),guid:t.metadata.guid}}})}async processQueue(){if(this.inFlightItems.length>0)return"ALREADY_SYNCING";let e={};for(let t of this.queuedItems){let r=e[t.entry.metadata.guid]??this.syncedItemsByGuid[t.entry.metadata.guid]??null;this.shouldAcceptItem({currentItem:r,newItem:t})&&(e[t.entry.metadata.guid]=t)}this.queuedItems=[];let t=Object.values(e);if(!t.length)return"NOTHING_TO_SYNC";try{this.inFlightItems=[...t];let e=await this.syncItems(t);try{this.onResponse(e,"sync")}catch(e){}return this.syncedItemsByGuid={...this.syncedItemsByGuid,...k()(t,e=>e.entry.metadata.guid)},this.inFlightItems=[],this.processQueue(),"SYNCED"}catch(e){if(this.queuedItems.unshift(...t),this.inFlightItems=[],(0,l.D)(e))return"ABORTED";return this.onSyncFailure(e instanceof Error?e:Error(String(e))),"FAILURE"}}syncItems(e){return(0,d.Y8)(async()=>{try{this.perfTracker.record("files_patch_start"),this.perfTracker.setSyncMetadata({sourceCodeHash:(0,n.D)().getSourceCodeHash()});let t=await p.ZP.foundry.sync({entrypointsByIdentifier:this.entrypointsByIdentifier,codeVfsEntryChanges:e,originHost:this.originHost,codeLibraryFormat:this.codeLibraryFormat},{...(0,m.ZP)()},{abortSignal:this.abortSignal});return this.perfTracker.setSyncMetadata({npmInstallDuration:t.npmInstallDuration,isSyncSuccessful:!0}),t}catch(e){throw this.perfTracker.setSyncMetadata({isSyncSuccessful:!1}),e}finally{this.perfTracker.record("files_patch_stop")}},{times:this.limitRetries?y.kC:void 0,interval:y.sg,exponentialBackoff:!0,maxBackoff:y.F5,abortSignal:this.abortSignal})}shouldAcceptItem({currentItem:e,newItem:t}){return!e||"delete"!==e.type&&("delete"===t.type||0>(0,v.QZ)(e.entry.metadata.version,t.entry.metadata.version))}sanitizedVersion(e){return e.replace(/^\[/,"").replace(/\]$/,"")}sanitizedPath(e){return e.replace(/^\//,"")}}var w=((a=w||{}).CACHED_PREVIEW="CACHED_PREVIEW",a.FAILED="FAILED",a.PENDING="PENDING",a.REPROVISIONING="REPROVISIONING",a.PROVISIONED="PROVISIONED",a);class S{constructor({originHost:e,fileKey:t,perfTracker:r}){this.syncer=null,this.sandboxUrl=null,this._codeLibraryFormat=0,this._initialized=!1,this._destroyed=!1,this.attachHandlers=e=>{this.onStateChange=e.onStateChange},this.initialize=()=>{if(!this.initialized&&!this.destroyed)return this._initialized=!0,h.RQ.trackDefinedEvent("foundry.file_open",{fileKey:this.fileKey,sourceCodeHash:this.vfs.getSourceCodeHash()}),this.initializeSandbox({firstInitialization:!0})},this.destroy=()=>{this._destroyed=!0,this.abortController.abort(),this.stopListeningToVfsChanges()},this.resetSandbox=()=>{this.sandboxUrl=null,this.stopListeningToVfsChanges(),this.abortController.abort(),this.syncer=null,this.abortController=new AbortController,this.initializeSandbox({firstInitialization:!1})},this.initializeSandbox=async({firstInitialization:e})=>{if(this.sandboxUrl)return;this.onStateChange?.({state:e?"PENDING":"REPROVISIONING"});let t=!1;if(e&&this.preloadCachedPreviewUrls().then(e=>{!t&&e&&this.onStateChange?.({state:"CACHED_PREVIEW",cachedPreview:e})}),this._codeLibraryFormat=(0,c.getActiveTSSceneGraph)().getLocalCodeLibraryOrNull()?.codeLibraryFormat??0,this.sandboxUrl=await (async()=>{try{return(await this.createSandbox()).url}catch(e){return this.stopListeningToVfsChanges(),(0,l.D)(e)||(this.onStateChange?.({state:"FAILED",error:e instanceof Error?e:Error(String(e))}),h.RQ.trackDefinedEvent("foundry.sandbox_failed",{step:"initializeSandbox_createSandbox"})),null}})(),this.sandboxUrl){try{let e=this.vfs.listFiles();if(this.startListeningToVfsChanges(),this.syncer=new C({entrypointsByIdentifier:this.vfs.getCodeIdentifierToEntrypoint(),originHost:this.originHost,abortSignal:this.abortController.signal,limitRetries:!this.uiFoundryEnabled,perfTracker:this.perfTracker,codeLibraryFormat:this.codeLibraryFormat,onSyncFailure:this.handleSyncFailure,onResponse:this.handleSandboxUrlResponse}),await this.syncer.sync({added:e,removed:[],moved:[],updated:[]},i.y.LOCAL)!==I.SYNCED)throw Error("Failure syncing files")}catch(e){this.stopListeningToVfsChanges(),(0,l.D)(e)||(this.onStateChange?.({state:"FAILED",error:e instanceof Error?e:Error(String(e))}),h.RQ.trackDefinedEvent("foundry.sandbox_failed",{step:"initializeSandbox_sync"}));return}t=!0,this.sandboxUrl&&(this.onStateChange?.({state:"PROVISIONED",url:this.sandboxUrl}),this.startKeepAlive())}},this.handleVfsEntriesChanged=(e,t)=>{this.syncer?.sync(e,t)},this.handleSyncFailure=e=>{this.stopListeningToVfsChanges(),this.onStateChange?.({state:"FAILED",error:e}),h.RQ.trackDefinedEvent("foundry.sync",{fileKey:this.fileKey,sourceCodeHash:(0,n.D)().getSourceCodeHash(),success:!1})},this.handleSandboxUrlResponse=(e,t)=>{this.sandboxUrl&&(!e.url||this.sandboxUrl!==e.url)&&this.resetSandbox(),"sync"===t?h.RQ.trackDefinedEvent("foundry.sync",{fileKey:this.fileKey,sourceCodeHash:(0,n.D)().getSourceCodeHash(),success:!0}):"keep-alive"===t&&h.RQ.trackDefinedEvent("foundry.keep_alive",{fileKey:this.fileKey,success:!0})},this.startListeningToVfsChanges=()=>{this.vfs.on("entriesChanged",this.handleVfsEntriesChanged)},this.stopListeningToVfsChanges=()=>{this.vfs.off("entriesChanged",this.handleVfsEntriesChanged)},this.createSandbox=()=>(0,d.Y8)(async()=>{try{this.perfTracker.record("sandbox_create_start");let e=await p.ZP.foundry.sandbox({originHost:this.originHost},{...(0,m.ZP)(),trackingSessionId:(0,f.ZP)().tracking_session_id},{abortSignal:this.abortController.signal});if("PROVISIONED"!==e.state)throw Error(`Sandbox not provisioned: ${e.state}`);return void 0!==e.newlyProvisioned&&this.perfTracker.setLoadMetadata({newlyProvisioned:e.newlyProvisioned}),e}finally{this.perfTracker.record("sandbox_create_stop")}},{times:y.mP,interval:y.RV,exponentialBackoff:!0,maxBackoff:y.cA,abortSignal:this.abortController.signal}),this.startKeepAlive=()=>{let e=setInterval(async()=>{try{if("visible"===document.visibilityState){let e=await p.ZP.foundry.keepAlive({},{...(0,m.ZP)(),trackingSessionId:(0,f.ZP)().tracking_session_id},{abortSignal:this.abortController.signal});this.handleSandboxUrlResponse(e,"keep-alive")}}catch(e){(0,l.D)(e)||h.RQ.trackDefinedEvent("foundry.keep_alive",{fileKey:this.fileKey,success:!1})}},y.JS);this.abortController.signal.addEventListener("abort",()=>{clearInterval(e)})},this.preloadCachedPreviewUrls=async()=>{if(!this.previewEnabled)return null;try{let e=(0,n.D)().getSourceCodeHash();this.perfTracker.record("cached_preview_urls_load_start");let t=await b.O.getCachedPreviewUrls({fileKey:this.fileKey,sourceCodeHash:e});return this.perfTracker.setLoadMetadata({isCachedPreviewUrlsLoadSuccessful:!0}),{jsUrl:t.data.meta.js_url,cssUrl:t.data.meta.css_url}}catch(e){this.perfTracker.setLoadMetadata({isCachedPreviewUrlsLoadSuccessful:!1})}finally{this.perfTracker.record("cached_preview_urls_load_stop")}},this.getCachedPreviewUrlsForTemplate=async({template:e,type:t})=>{if(!this.previewEnabled)return null;try{let r=await function(){switch(t){case _.W.HubFile:return g.D.getCachedPreviewUrls({hubFileId:e.id});case _.W.TeamTemplate:return x.U.getCachedPreviewUrls({templateFileKey:e.file_key});case _.W.TeamTemplateLg:return x.U.getCachedPreviewUrls({templateFileKey:e.fileKey});default:(0,o.vE)(t)}}();return{jsUrl:r.data.meta.js_url,cssUrl:r.data.meta.css_url}}catch(e){return null}},this.originHost=e,this.abortController=new AbortController,this.perfTracker=r,this.vfs=(0,n.D)(),this.fileKey=t,this.previewEnabled=!!(0,u.BZ)().make_foundry_cache_preview_client,this.uiFoundryEnabled=!!(0,u.BZ)().make_foundry_ui_org||!!(0,u.BZ)().make_foundry_ui_pro||!!(0,u.BZ)().make_foundry_ui_starter}get initialized(){return this._initialized}get codeLibraryFormat(){return this._codeLibraryFormat}get destroyed(){return this._destroyed}}},920066:function(e,t,r){r.d(t,{T:()=>m,Z:()=>_});var s=r(853505),a=r(390490);if(9793==r.j)var i=r(850340);var n=r(539767),l=r(363240),o=r(444947),d=r(889437),c=r(834761);if(9793==r.j)var u=r(452549);if(9793==r.j)var h=r(271609);if(9793==r.j)var f=r(16869);if(9793==r.j)var p=r(771252);let m=(0,c.gI)(()=>(0,l.cn)(null));function _({fileKey:e,isFoundryEnabled:t}){let r=new URL((0,l.Dv)(f.S4)).host,c=(0,d.hS)(new u.D({isFoundry:!0})),[_,g]=(0,s.useState)(!1),b=(0,h.pG)().codeLibraryInstance,x=(0,s.useMemo)(()=>!!b,[b]),y=(0,s.useMemo)(()=>!_&&e&&t?new p.Z({originHost:r,fileKey:e,perfTracker:c}):null,[_,e,t,r,c]);(0,s.useEffect)(()=>{t&&1>(0,a.sE)()&&n.y2.system("set-local-code-library-format",()=>{(0,a.BO)(1)})},[t]);let[v,j]=(0,l.KO)(m),k=(0,s.useRef)(!1);(0,s.useEffect)(()=>{!t||v||k.current||(j({state:p.z.PENDING,perfTracker:c}),k.current=!0)},[t,c,v,j]);let I=(0,s.useCallback)(e=>{switch(e.state){case p.z.PENDING:j({state:p.z.PENDING,perfTracker:c});break;case p.z.CACHED_PREVIEW:j({state:p.z.CACHED_PREVIEW,cachedPreview:e.cachedPreview,perfTracker:c});break;case p.z.REPROVISIONING:j({state:p.z.REPROVISIONING,perfTracker:c});break;case p.z.PROVISIONED:j({state:p.z.PROVISIONED,url:e.url,perfTracker:c});break;case p.z.FAILED:j({state:p.z.FAILED,error:e.error.message,perfTracker:c});break;default:(0,i.jT)(e,void 0,"Unknown sandbox state change")}},[c,j]);return(0,s.useEffect)(()=>{y?.attachHandlers({onStateChange:I})},void 0),(0,s.useEffect)(()=>{y&&!y.initialized&&x&&(j({state:p.z.PENDING,perfTracker:c}),y.initialize())},[y,x,c,j]),(0,s.useEffect)(()=>{y&&v?.state===p.z.FAILED&&y.codeLibraryFormat<=1&&(y.destroy(),g(!0),j(null),e&&o.RQ.trackDefinedEvent("foundry.fallback_to_esbuild",{fileKey:e}))},[v?.state,y,e,j]),(0,s.useEffect)(()=>()=>{y?.destroy()},[y]),v}},913206:function(e,t,r){r.d(t,{g:()=>i});var s=r(853505),a=r(750357);let i=(0,s.memo)(function(e){return(0,a.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",...e,"data-fpl-icon-size":"16",children:(0,a.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",d:"M7.646 6.404a.5.5 0 0 1 .707 0l2.122 2.121a.5.5 0 0 1-.708.707L8 7.465 6.232 9.232a.5.5 0 0 1-.707-.707z"})})})},777452:function(e,t,r){var s,a;r.d(t,{y:()=>s}),(a=s||(s={}))[a.LOCAL=0]="LOCAL",a[a.REMOTE=1]="REMOTE"}}]);

//# debugId=c9422536-34e5-5d8e-abcc-7c3261c728e9

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/0ed00e99b8ffee671be6614376affb022e043db9/9679-b60283daf9a9475a.min.js.map